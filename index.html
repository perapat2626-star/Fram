<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Farm Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; text-align: center; padding: 20px; }
        .card { background: #1e293b; padding: 20px; border-radius: 15px; margin: 10px auto; max-width: 400px; border: 1px solid #334155; }
        .percent { font-size: 60px; color: #22c55e; font-weight: bold; }
        .btn { width: 45%; padding: 12px; margin: 5px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; color: white; }
        .on-btn { background: #10b981; } .off-btn { background: #ef4444; }
        .status-label { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 14px; margin-bottom: 10px; border: 1px solid; }
        .st-on { color: #34d399; border-color: #34d399; } .st-off { color: #f87171; border-color: #f87171; }
        input[type='time'] { width: 80%; padding: 10px; margin: 5px; border-radius: 8px; font-size: 18px; background: #334155; color: white; border: none; }
    </style>
</head>
<body>
    <h2>üå± ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏•‡∏π‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h2>
    
    <div class="card">
        <p>üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏î‡∏¥‡∏ô</p>
        <div id="moist-display" class="percent">0</div>
        <span>‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå (%)</span>
    </div>

    <div class="card">
        <h3>üí° ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏™‡πà‡∏≠‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á</h3>
        <div id="light-status" class="status-label">‡πÇ‡∏´‡∏•‡∏î...</div><br>
        <button onclick="sendCmd('light','ON')" class="btn on-btn">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü</button>
        <button onclick="sendCmd('light','OFF')" class="btn off-btn">‡∏õ‡∏¥‡∏î‡πÑ‡∏ü</button>
        <hr style="border:0.1px solid #334155; margin:15px 0;">
        ‡πÄ‡∏õ‡∏¥‡∏î: <input type="time" id="timeOn"> ‡∏õ‡∏¥‡∏î: <input type="time" id="timeOff">
        <button onclick="setTimer()" class="btn" style="background:#3b82f6; width:90%; margin-top:10px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</button>
    </div>

    <div class="card">
        <h3>üíß ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥</h3>
        <div id="pump-status" class="status-label">‡πÇ‡∏´‡∏•‡∏î...</div><br>
        <button onclick="sendCmd('pump','ON')" class="btn on-btn">‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏±‡πä‡∏°</button>
        <button onclick="sendCmd('pump','OFF')" class="btn off-btn">‡∏õ‡∏¥‡∏î‡∏õ‡∏±‡πä‡∏°</button>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://fram-1fd7e-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ö‡∏°‡∏≤‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå (1023->0, 0->100)
        db.ref("status/moisture").on("value", s => {
            let pct = Math.round(((1023 - s.val()) / 1023) * 100);
            document.getElementById("moist-display").innerText = pct;
        });

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡πä‡∏°‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        db.ref("control/light").on("value", s => {
            let status = s.val();
            document.getElementById("light-status").innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " + (status == "ON" ? "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" : "‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
            document.getElementById("light-status").className = "status-label " + (status == "ON" ? "st-on" : "st-off");
        });

        db.ref("control/pump").on("value", s => {
            let status = s.val();
            document.getElementById("pump-status").innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " + (status == "ON" ? "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" : "‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
            document.getElementById("pump-status").className = "status-label " + (status == "ON" ? "st-on" : "st-off");
        });

        function sendCmd(t, a) { db.ref("control/" + t).set(a); }
        function setTimer() {
            const on = document.getElementById("timeOn").value;
            const off = document.getElementById("timeOff").value;
            if(on && off) {
                db.ref("timer").set({on, off});
                alert("‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            }
        }
    </script>
</body>
</html>
