<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Garden</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; text-align: center; display: flex; justify-content: center; padding: 20px; }
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        .moisture-circle { width: 150px; height: 150px; border-radius: 50%; border: 8px solid #4caf50; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold; color: #2e7d32; }
        .btn { border: none; padding: 15px; border-radius: 10px; cursor: pointer; width: 45%; font-weight: bold; color: white; margin: 5px; }
        .on { background: #4caf50; } .off { background: #f44336; }
        .timer-box { text-align: left; margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }
        input[type="time"] { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>

<div class="card">
    <h2>üçÄ Smart Garden</h2>
    <div class="moisture-circle"><span id="moisture">0</span>%</div>
    <p>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏î‡∏¥‡∏ô</p>

    <div style="display: flex; justify-content: space-between;">
        <button id="pumpBtn" class="btn off" onclick="toggle('pump')">‡∏õ‡∏±‡πâ‡∏°‡∏ô‡πâ‡∏≥: ‡∏õ‡∏¥‡∏î</button>
        <button id="lightBtn" class="btn off" onclick="toggle('light')">‡πÑ‡∏ü: ‡∏õ‡∏¥‡∏î</button>
    </div>

    <div class="timer-box">
        <strong>‚è∞ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡πÑ‡∏ü</strong>
        <input type="time" id="onTime" onchange="setTimer('on', this.value)">
        <input type="time" id="offTime" onchange="setTimer('off', this.value)">
    </div>
</div>

<script>
    // --- ‡πÉ‡∏™‡πà‡πÅ‡∏Ñ‡πà 2 ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å Firebase ---
    const config = {
        apiKey: "tY8jvGbcyjTYe0Vb5zsGwuaBFYPeccmqck91gYnU",
        databaseURL: "https://fram-1fd7e-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(config);
    const db = firebase.database();

    // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Realtime)
    db.ref().on('value', (snap) => {
        const data = snap.val() || {};
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô
        document.getElementById('moisture').innerText = data.status?.moisture || 0;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°
        updateBtn('pumpBtn', '‡∏õ‡∏±‡πâ‡∏°‡∏ô‡πâ‡∏≥', data.control?.pump);
        updateBtn('lightBtn', '‡πÑ‡∏ü', data.control?.light);
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
        if(data.settings?.onTime) document.getElementById('onTime').value = data.settings.onTime;
        if(data.settings?.offTime) document.getElementById('offTime').value = data.settings.offTime;
    });

    function updateBtn(id, label, isOn) {
        const el = document.getElementById(id);
        el.innerText = `${label}: ${isOn ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î'}`;
        el.className = `btn ${isOn ? 'on' : 'off'}`;
    }

    function toggle(path) {
        const ref = db.ref('control/' + path);
        ref.once('value').then(s => ref.set(!s.val()));
    }

    function setTimer(type, val) {
        db.ref('settings/' + type + 'Time').set(val);
    }
</script>

</body>
</html>
