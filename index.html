<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Farm Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Kanit', sans-serif; background: #0f172a; color: white; text-align: center; padding: 20px; }
        .card { background: #1e293b; padding: 20px; border-radius: 15px; margin: 10px auto; max-width: 380px; border: 1px solid #334155; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå */
        #moist-percent { font-size: 60px; color: #22c55e; font-weight: bold; }
        .unit { font-size: 20px; color: #94a3b8; }

        /* ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° */
        .btn { width: 45%; padding: 12px; margin: 5px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; color: white; transition: 0.3s; }
        .on-btn { background: #10b981; } .off-btn { background: #ef4444; }
        .save-btn { background: #3b82f6; width: 90%; margin-top: 10px; }
        
        /* ‡πÑ‡∏ü‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Status Badge) */
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 14px; margin-top: 10px; font-weight: bold; }
        .status-on { background: #064e3b; color: #34d399; border: 1px solid #34d399; }
        .status-off { background: #450a0a; color: #f87171; border: 1px solid #f87171; }

        input[type='time'] { width: 80%; padding: 10px; margin: 5px; border-radius: 8px; border: none; font-size: 18px; background: #334155; color: white; }
        h3 { margin-bottom: 5px; color: #cbd5e1; }
    </style>
</head>
<body>
    <h2>üå± ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏•‡∏π‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h2>

    <div class="card">
        <p>üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏î‡∏¥‡∏ô</p>
        <div id="moist-percent">0</div>
        <span class="unit">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå (%)</span>
    </div>

    <div class="card">
        <h3>üí° ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏™‡πà‡∏≠‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á</h3>
        <div id="light-status" class="status-badge">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        <div style="margin-top: 15px;">
            <button onclick="set('light','ON')" class="btn on-btn">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü</button>
            <button onclick="set('light','OFF')" class="btn off-btn">‡∏õ‡∏¥‡∏î‡πÑ‡∏ü</button>
        </div>
        <hr style="border: 0.5px solid #334155; margin: 20px 0;">
        <h3>‚è∞ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h3>
        ‡πÄ‡∏õ‡∏¥‡∏î: <input type="time" id="onT"> ‡∏õ‡∏¥‡∏î: <input type="time" id="offT">
        <button onclick="saveT()" class="btn save-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</button>
    </div>

    <div class="card">
        <h3>üíß ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥</h3>
        <div id="pump-status" class="status-badge">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        <div style="margin-top: 15px;">
            <button onclick="set('pump','ON')" class="btn on-btn">‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏±‡πä‡∏°</button>
            <button onclick="set('pump','OFF')" class="btn off-btn">‡∏õ‡∏¥‡∏î‡∏õ‡∏±‡πä‡∏°</button>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://fram-1fd7e-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô %
        db.ref("status/moisture").on("value", (s) => {
            let val = s.val();
            // ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì: (‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ / 1024) * 100 
            // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ñ‡πâ‡∏≤ Sensor ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ: 100 - ((val/1024)*100)
            let percent = Math.round((val / 1024) * 100); 
            document.getElementById("moist-percent").innerText = percent;
        });

        // 2. ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏ü (Real-time)
        db.ref("control/light").on("value", (s) => {
            const statusStr = s.val();
            const el = document.getElementById("light-status");
            el.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " + (statusStr === "ON" ? "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" : "‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
            el.className = "status-badge " + (statusStr === "ON" ? "status-on" : "status-off");
        });

        // 3. ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡πä‡∏° (Real-time)
        db.ref("control/pump").on("value", (s) => {
            const statusStr = s.val();
            const el = document.getElementById("pump-status");
            el.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " + (statusStr === "ON" ? "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" : "‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
            el.className = "status-badge " + (statusStr === "ON" ? "status-on" : "status-off");
        });

        function set(t, a) { db.ref("control/" + t).set(a); }
        function saveT() {
            const on = document.getElementById("onT").value;
            const off = document.getElementById("offT").value;
            if(on && off) {
                db.ref("timer").set({on, off});
                alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß!");
            } else { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö"); }
        }
    </script>
</body>
</html>
